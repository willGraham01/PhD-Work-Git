\section{Derivation and Formulation of Quantum Graph Problem} \label{sec:SystemDerivation}

In this section we provide an overview of how we obtain the system \eqref{eq:QGFullSystem} from \eqref{eq:PeriodCellLaplaceStrongForm}, which will setup our discussion revolving around the methods that can be employed for solving \eqref{eq:QGFullSystem} in section \ref{sec:Discussion}.
Precise definition and analysis of the ``Sobolev spaces" used here can be found in the appendix (section \ref{ssec:SobSpacesTheory}). \tstk{We should maybe give an intuitive overview here, just in case? (maybe a short subsection?}
Also, just to reiterate what was said in section \ref{sec:QuantumGraphs}, assumption \ref{ass:MeasTheoryProblemSetup} is adopted throughout this section and the rest of this work. \newline

A function $u\in\gradSobQM{\ddom}{\ddmes}$ solves \eqref{eq:PeriodCellLaplaceStrongForm} if and only if
\begin{align} \label{eq:PeriodCellLaplaceWeakForm}
	\integral{\ddom}{\tgrad_{\ddmes}u\cdot\overline{\tgrad_{\ddmes}\phi}}{\ddmes} &= \omega^2\integral{\ddom}{u\overline{\phi}}{\ddmes}, \quad\forall \phi\in\smooth{\ddom}.
\end{align}
We first note that since we require this expression to hold for all smooth functions $\phi$, then for each $I_{jk}\in \edgeSet$ it must in hold for those smooth functions $\psi$ whose support intersects the interior of the edge $I_{jk}$ and no other parts of $\graph$.
Combined with the fact that $\ddmes$ is just a sum of the edge measures (and point masses at the vertices), in this case we can reduce \eqref{eq:PeriodCellLaplaceWeakForm} to
\begin{align*}
	0 &= \integral{\ddom}{\tgrad_\ddmes u \cdot \overline{\tgrad\psi} - \omega^2 u\overline{\psi}}{\ddmes} \\
	&= \integral{I_{jk}}{ \tgrad_{\lambda_{jk}}u \cdot \overline{\tgrad\psi} - \omega^2 u_{jk}\overline{\psi} }{\lambda_{jk}} \\
	&= \integral{I_{jk}}{ \bracs{u_{jk}' + i\bracs{R_{jk}\qm}_1 u_{jk}}\bracs{\overline{\psi}' - i\bracs{R_{jk}\qm}_1 \overline{\psi} } - \omega^2 u_{jk}\overline{\psi} }{\lambda_{jk}}.
\end{align*}
Now using $r_{jk}$ as a change of variables and denoting $\tilde{u} = u \circ r_{jk}$ and $\varphi = \psi\circ r_{jk}$ we arrive at
\begin{align*}
	0 &= \int_{0}^{\abs{I_{jk}}} \bracs{\tilde{u}_{jk}' + i\bracs{R_{jk}\qm}_1 \tilde{u}_{jk}}\bracs{\overline{\varphi}' - i\bracs{R_{jk}\qm}_1 \overline{\varphi} } - \omega^2 \tilde{u}_{jk}\overline{\varphi} \ \md t .
\end{align*}
This holds for all smooth $\varphi$ with support contained in the interior of $\interval{I_{jk}}$, and can be thought of as the weak form of the equation
\begin{align*}
	-\bracs{\diff{}{t} + i\qm_{jk}}^2 \tilde{u}_{jk} &= \omega^2 \tilde{u}_{jk}, \quad t\in\interval{I_{jk}}.
\end{align*}
Under the assumption that $\tilde{u}_{jk}$ has enough regularity to be differentiated again, this is precisely what we have arrived at.
Since we can repeat this process for each $I_{jk}$, we essentially have an ODE that must be satisfied on each edge of the graph $\graph$. \newline

Now we turn our attention to the vertices to derive the vertex conditions we will need to complete our ODEs on the edges. \tstk{if coupling constants are non-zero this part changes!!!!}
Fix a specific $v_j\in \vertSet$, and consider functions $\psi\in\smooth{\ddom}$ whose support only intersects $\graph$ in some neighbourhood of $v_j$ that only contains edges which connect to $v_j$ (imagine the support as a ball centred on $v_j$, for example).
Then we can work from \eqref{eq:PeriodCellLaplaceWeakForm} to obtain
\begin{align*}
	0 &= \sum_{j\con k} \integral{I_{jk}}{ \tgrad_\ddmes u \cdot \overline{\tgrad\psi} - \omega^2 u\overline{\psi} }{\lambda_{jk}} \\
	&= \sum_{j\con k} \int_{0}^{\abs{I_{jk}}} \bracs{\tilde{u}_{jk}' + i\bracs{R_{jk}\qm}_1 \tilde{u}_{jk}}\bracs{\overline{\varphi}' - i\bracs{R_{jk}\qm}_1 \overline{\varphi} } - \omega^2 \tilde{u}_{jk}\overline{\varphi} \ \md t,
\end{align*}
where we have again used $r_{jk}$ as a change of variables (and the same notation for the transforms of $u$ and $\psi$).
Under the assumption that $\tilde{u}_{jk}$ can be differentiated again, we can integrate by parts in each integral to obtain
\begin{align*}
	0 &= \sum_{j\con k} - \int_{0}^{\abs{I_{jk}}} \bracs{ \bracs{\diff{}{t} + i\qm_{jk}}^2 \tilde{u}_{jk} +\omega^2 \tilde{u}_{jk} }\overline{\varphi} \ \md t
	+ \sum_{j\con k}\overline{\varphi}\bracs{v_j}\bracs{\diff{}{t} + i\qm_{jk}}\tilde{u}_{jk}\bracs{v_j} \\
	&= \overline{\varphi}\bracs{v_j}\sum_{j\con k}\bracs{\diff{}{t} + i\qm_{jk}}\tilde{u}_{jk}\bracs{v_j}.
\end{align*}
Given that this holds for every smooth $\varphi$, and we can repeat the argument for each $v_j\in \vertSet$, we arrive at the condition that \tstk{coupling constant on LHS general case!!!!}
\begin{align*}
	0 &= \sum_{j\con k}\bracs{\diff{}{t} + i\qm_{jk}}\tilde{u}_{jk}\bracs{v_j}, \quad \forall v_j \in \vertSet.
\end{align*}
This is a Kirchoff-like condition on the derivatives of the edge-wise components of $u$, similar to those introduced in section \ref{sec:QuantumGraphs}.
Given the result of theorem \ref{thm:CharOfGradSob} tells us that functions $u\in\gradSobQM{\ddom}{\ddmes}$ are also continuous at each vertex $v_j$, then we have thus derived the following problem:
\begin{align*}
	-\bracs{\diff{}{t} + i\qm_{jk}}^2 \tilde{u}_{jk} = \omega^2 \tilde{u}_{jk}, &\quad t\in\interval{I_{jk}}, \ \forall I_{jk}\in \edgeSet, \\
	u \text{ is continuous across each } &v_j \in \vertSet, \\
	0 = \sum_{j\con k}\bracs{\diff{}{t} + i\qm_{jk}}\tilde{u}_{jk}\bracs{v_j}, &\quad \forall v_j \in \vertSet.
\end{align*}
That is, we have arrived at \eqref{eq:QGFullSystem}.
Solving for the eigenvalues $\omega^2$ will net us the eigenvalues of our original problem \eqref{eq:PeriodCellLaplaceStrongForm} and taking the union of the eigenvalues over $\qm$ will provide the spectrum of \eqref{eq:WholeSpaceLaplaceEqn}.
As will be made clear in the discussion that follows, the quantum graph problem \eqref{eq:QGFullSystem} is much easier to handle both analytically and numerically.