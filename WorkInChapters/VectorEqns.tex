\chapter{Vector Equations} \label{ch:VectorEqns}
Chapter \ref{ch:ScalarEqns} introduced the theory of Sobolev spaces $\gradSob{D}{\nu}$ with respect to arbitrary (Borel) measures $\nu$, and how we can make sense of the notion of ``derivative" and pose problems in these spaces.
Also investigated was how (under suitable regularity assumptions) the variational problems that can be posed are reduced to Quantum Graph problems, when the measure $\nu$ supports a graph embedded into the domain $D$. \newline

In this chapter we look to develop this theory to handling vector-valued systems of equations, which necessitates developing theory for the associated curl- and divergence-operations, as well as the associated Sobolev spaces.
We begin with the definition and construction of these spaces, during which we will demonstrate parallels with the previously seen concepts of ``tangential-gradients".
In fact, many of the arguments in this chapter will be inspired or grounded in the approaches taken in chapter \ref{ch:ScalarEqns}.
After this we will discuss slightly altered versions of these spaces, which will arise from considering the wave-propagation problems of interest to us.
We will provide a worked example in this context, and once again demonstrate how we can obtain a Quantum Graphs problem from a variational formulation when the measure $\nu$ supports a graph in the $\bracs{x_1,x_2}$-plane.

\section{Vector Sobolev Spaces} \label{sec:VectorSobSpaces}
In this section we present the construction of Sobolev spaces of vector-valued functions that possess curls (in some sense) with respect to an arbitrary (Borel) measure $\nu$.
In later sections we will adapt the construction of these spaces to suit our physical wave-guide and photonic-fibre systems; by taking a Fourier transform along the axis of the wave-guide and also incorporating the quasi-momentum that arises from taking a Gelfand transform in the cross-section.
The reader is invited to bear in mind the arguments employed in section \ref{sec:ScalarSobSpaces} throughout this section. \newline

We write $D\subset\reals^3$ for our 3D-domain, and let $\nu$ be an arbitrary (Borel) measure on $D$.
Let $W=W\bracs{D,\md\nu}$ be the closure of the set of pairs $\bracs{\phi, \curl{}\phi}$ in $\ltwo{D}{\nu}^3\times\ltwo{D}{\nu}^3$ for $\phi\in\smooth{D}$.
Given that this is essentially the same construction as in section \ref{sec:ScalarSobSpaces}, it is unsurprising to learn that some work must be done before the element $c$ in the pair $\bracs{u,c}\in W$ can be thought of as a ``curl".
Indeed we actually have the same problem as in the gradient case; if both $\bracs{u,c_1}, \bracs{0, c_2}\in W$ then $\bracs{u,c_1+c_2}\in W$, and so we define the set of $\nu$-curls of zero as
\begin{align*}
	\curlZero{D}{\nu} &:= \clbracs{ c\in\ltwo{D}{\nu}^3 \ \vert \ \bracs{0,c}\in W }, \\
	&= \clbracs{ c\in\ltwo{D}{\nu}^3 \ \vert \ \exists\phi\in\bracs{\smooth{D}}^3 \text{ s.t. } \phi_n\lconv{\ltwo{D}{\nu}^3}0, \curl{}\phi_n\lconv{\ltwo{D}{\nu}^3}c }
\end{align*}
Fortunately we have the same workaround (or fix) to address this issue as in the gradient case, namely that $\curlZero{D}{\nu}$ is a closed linear subspace of $\ltwo{D}{\nu}^3$ so we can write
\begin{align*}
	\ltwo{D}{\nu}^3 = \curlZero{D}{\nu}^\perp \oplus \curlZero{D}{\nu},
\end{align*}
thus every $u\in\ltwo{D}{\nu}^3$ has a unique tangential $\nu$-curl, $\curl{\nu} u$ such that every $\bracs{u,c}\in W$ can be written in the form $\bracs{u, \curl{\nu}u + \widetilde{c}}\in W$ for some $\widetilde{c}\in\curlZero{D}{\nu}$.
Thus we can define the Sobolev space of functions $u$ with $\nu$-curls by
\begin{align*}
	\curlSob{D}{\nu} := \clbracs{ \bracs{u,\curl{\nu}u}\in W },
\end{align*}
and although elements of this space are technically pairs, it is sufficient to specify only the first component $u$ to identify the pair.
We can also pose problems in this space using a variational formulation in an analogous way to gradients; we write
\begin{align*}
	\curl{\nu}\bracs{A\curl{\nu}u} + u &= f, \quad u\in\curlSob{D}{\nu},
\end{align*}
and interpret this as the variational problem of finding $u\in\curlSob{D}{\nu}$ such that
\begin{align*}
	\integral{D}{ A\bracs{\curl{\nu}u}\cdot\overline{\bracs{\curl{}\phi}} + u\overline{\phi}}{\nu} &= \integral{D}{ f\overline{\phi} }{\nu}, \quad \forall\phi\in\bracs{\smooth{D}}^3.
\end{align*}
Such problems actually serve as the motivation for the notion of the tangential curl that is provided in the same way as tangential gradients were motivated.
The elliptic matrix $A$ simply requires us to write $A\curl{\nu}u$ for the element in $\curlZero{D}{\nu}^\perp$, the details being analogous to those in section \ref{sec:ScalarSobSpaces} for gradients. \newline

We also interpret spectral problems in the variational setting, so 
\begin{align*}
	\curl{\nu}\bracs{\curl{\nu}u} &= \lambda u, \quad u\in\curlSob{D}{\nu},
\end{align*}
is interpreted as the problem of finding $\lambda\in\complex, u\in\curlSob{D}{\nu}$ such that
\begin{align*}
	\integral{D}{ \bracs{\curl{\nu}u}\cdot\overline{\bracs{\curl{}\phi}} }{\nu} &= \lambda \integral{D}{ u\overline{\phi} }{\nu}, \quad \forall\phi\in\bracs{\smooth{D}}^3.
\end{align*}
Taking $\phi = \grad\psi$ for some $\psi\in\smooth{D}$, then we have that
\begin{align*}
	0 &= \lambda \integral{D}{ u\overline{\grad\psi}}{\nu}, \quad \forall \psi\in\smooth{D}.
\end{align*}
This gives rise to the notion of $\nu$-divergence free functions, which we define as follows.
\begin{definition}
	A function $u\in\ltwo{D}{\nu}^3$ is $\nu$-divergence free if
	\begin{align*}
		\integral{D}{ u\cdot\overline{\grad_{\nu}f} }{\nu} &= 0, \quad \forall f\in\gradSob{D}{\nu}.
	\end{align*}	 
\end{definition}
Of course due to the density of $\smooth{D}$ in $\ltwo{D}{\nu}$ and the construction of $\gradSob{D}{\nu}$, it is sufficient to test the condition
\begin{align*}
	\integral{D}{ u\cdot\overline{\grad\psi} }{\nu} &= 0, \quad \forall \psi\in\smooth{D}
\end{align*}
to show that $u$ is $\nu$-divergence free (due to the applicability of the aforementioned limiting and density arguments).

\tstk{on the divergence-free condition and why we need it !!!}

\section{Illustrative Examples} \label{sec:CurlExamples}
\tstk{everything is a curl of zero on segment example, and (hopefully, if you fix it!) the plane-example for the interpretation.}

Let $I$ be a segment in $\reals^3$ with $x_2=x_3=0$ on $I$, and let $\nu$ be the singular measure on $\reals^3$ that supports 1D Lebesgue measure on $I$.
In this setup we demonstrate that $\curlZero{\reals^3}{\nu}$ actually coincides with the whole of $\ltwo{\reals^3}{\nu}$, so the only tangential $\nu$-curl is the zero function!
To this end, let $f\in\smooth{\reals^3}$, $v=\bracs{0,0,f}^\top\in\ltwo{\reals^3}{\nu}^3$ and consider the ``sequence" of functions $\phi^{(n)}=\phi=\bracs{-x_2 f, 0, 0}^\top$.
Then we have that
\begin{align*}
	\integral{\reals^3}{\abs{\phi}^2}{\nu} &= \integral{I}{x_2^2\abs{f}^2}{\nu} \\
	&= 0, \quad \text{as } x_2=0 \text{ on } I.
\end{align*}
Furthermore,
\begin{align*}
	\integral{\reals^3}{\abs{\curl{}\phi - v}^2}{\nu} &= \integral{I}{\abs{0-0}^2}{\nu} + \integral{I}{\abs{-x_2\partial_3 f - 0}^2}{\nu} + \integral{I}{\abs{f + x_2\partial_2 f - f}^2}{\nu} \\
	&= \integral{I}{x_2^2\abs{f}^2}{\nu} + \integral{I}{x_2^2\abs{\partial_2 f}^2}{\nu}
	= 0.
\end{align*}
Thus the (constant) sequence $\bracs{\phi^{(n)}}_{n\in\naturals}$ is such that
\begin{align*}
	\phi^{(n)} \lconv{\ltwo{\reals^3}{\nu}^3} 0, &\quad \curl{}\phi^{(n)} \lconv{\ltwo{\reals^3}{\nu}^3} v,
\end{align*}
and thus $v\in\curlZero{\reals^3}{\nu}$.
A similar argument then applies in the cases when;
\begin{itemize}
	\item $v=\bracs{0, f, 0}^\top$, by choosing the constant sequence $\phi = \bracs{x_3 f, 0, 0}^\top$.
	\item $v=\bracs{f, 0, 0}^\top$, by choosing the constant sequence $\phi = \bracs{0, -x_3 f, 0}^\top$.
\end{itemize}
As such we conclude that if $f\in\smooth{\reals^3}$, then
\begin{align*}
	\begin{pmatrix}	f \\ 0 \\ 0	\end{pmatrix},
	\begin{pmatrix}	0 \\ f \\ 0	\end{pmatrix},
	\begin{pmatrix}	0 \\ 0 \\ f	\end{pmatrix}
	\in \curlZero{\reals^3}{\nu}.
\end{align*}
But then applying density arguments for $\smooth{\reals^3}$ in $\ltwo{\reals^3}{\nu}$ and the fact that $\curlZero{\reals^3}{\nu}$ is a closed linear subspace of $\ltwo{\reals^3}{\nu}^3$ by definition, we must conclude that
\begin{align*}
	\curlZero{\reals^3}{\nu} &= \mathrm{span}\clbracs{	
	\begin{pmatrix}	f \\ 0 \\ 0	\end{pmatrix},
	\begin{pmatrix}	0 \\ f \\ 0	\end{pmatrix},
	\begin{pmatrix}	0 \\ 0 \\ f	\end{pmatrix}
	\ \vert \ f\in\ltwo{\reals^3}{\nu}
	} \\
	&= \ltwo{\reals^3}{\nu}.
\end{align*}

\tstk{what about plane-measure case? Can't get that to work still - can in-plane directions are arbitrary l2 functions, but can't prove that orthogonal part to plane is zero.}

\section{$\wavenumber$-curls and Quasi-Momentum} \label{sec:kCurlsAndQM}
As discussed in chapter \ref{ch:Intro}, the physical systems of interest to us are those involving wave-guidance .
In particular we will typically be seeking solutions in the form of a travelling wave down the axis of the wave-guide, and solving for the transverse components of the wave in the cross-section of the guide.
In such problems it is standard practice to take a Fourier transform in the direction along the wave-guide axis; in our case this coincides with the $x_3$ co-ordinate direction.
As such we introduce the Fourier variable $\wavenumber$ and accordingly adjust the $\grad$ operator to account for this transform, denoting by $\kgrad$ the operator
\begin{align*}
	\kgrad\phi := \begin{pmatrix} \partial_1\phi \\ \partial_2\phi \\ i\wavenumber\phi\end{pmatrix}
\end{align*}
for all smooth functions $\phi$ of the cross-section variables $x_1,x_2$ which map into $\complex^3$.
Furthermore; under the assumptions laid out in section \ref{sec:PhysicalSystem} \tstk{this needs to exist at some point!} we will also be taking a Gelfand transform in our periodic, yet infinite, cross-section plane to obtain a family of problems on the period cell $\ddom$ parametrised by the quasi-momentum $\qm$.
Thus in the systems that we are considering it will be necessary for us to consider the operator $\ktgrad$ which element-wise is defined as
\begin{align*}
	\ktgrad := \kgrad + i\begin{pmatrix} \qm_1 \\ \qm_2 \\ 0 \end{pmatrix}.
\end{align*}
One can then construct the sets
\begin{align*}
	W^{\wavenumber, \qm}_{\mathrm{curl}} &:= \overline{ \clbracs{ \bracs{\phi, \ktcurl{}\phi} \ \vert \ \phi\in\bracs{\smooth{\ddom}}^3 } }, \\
	W^{\wavenumber, \qm}_{\mathrm{grad}} &:= \overline{ \clbracs{ \bracs{\phi, \ktgrad\phi} \ \vert \ \phi\in\smooth{\ddom} } },
\end{align*}
and then follow the construction method to obtain the spaces $\ktcurlSob{\ddom}{\ddmes}$ and $\ktgradSob{\ddom}{\ddmes}$.
Since $\ktgrad$ is nothing more than the result of unitary transforms on the function spaces considered in section \ref{sec:VectorSobSpaces}, the theory is preserved, however we must still perform some explicit computations to characterise the objects that we will be working with.
Also note that the operator $\ktgrad$ replaces the operator $\grad$, and so we are in effect seeking the $\bracs{\wavenumber,\qm}$-tangential curl, gradient, and divergence-free conditions. 
We will adopt the notation $\kcurlZero{\ddom}{\ddmes}$ for the set of ``$\wavenumber$-curls of zero and $\kgradZero{\ddom}{\ddmes}$ for the set of $\wavenumber$-gradients of zero;
\begin{align*}
	\kcurlZero{\ddom}{\ddmes} &= \clbracs{ c \ \vert \ \bracs{0,z,c}\in W^{\wavenumber}_{\mathrm{curl}}}, \\
	\kgradZero{\ddom}{\ddmes} &= \clbracs{ z \ \vert \ \bracs{0,z,c}\in W^{\wavenumber}_{\mathrm{grad}}}.
\end{align*}
It will be shown in the relevant sections that these sets are invariant under changes to $\qm$ hence we only write $W^{\wavenumber} = W^{\wavenumber, 0}$.
Throughout this section we will also assume our usual set-up; we have some period cell $\ddom$ in which is an embedded graph $\graph=\bracs{V,E}$, and we denote by $\ddmes$ the singular measure supported on the edges of $\graph$.

\subsection{$\bracs{\wavenumber,\qm}$-gradients} \label{sec:ktGradients}
In this subsection we will work towards characterising $\bracs{\wavenumber,\qm}$-tangential gradients.
This will first involve us characterising the set of gradients of zero, $\kgradZero{\ddom}{\ddmes}$, however there will be several parallels with the methods and results of section \ref{sec:ScalarExample}. 
We begin by showing that the gradients of zero that we shall be dealing with are invariant under changes in $\qm$ (just like in the scalar case) and so throughout the notation $\kgradZero{\ddom}{\ddmes}$ will be sufficient, and we can always consider the $\qm=0$ case in our working.
\begin{prop}[$\wavenumber$-Gradients of Zero are Invariant Under Quasi-Momentum] \label{prop:kGradZeroInvarientUnderQM}
	Let $\qm\in[-\pi,\pi)^2$ and set 
	\begin{align*}
		\mathcal{G}^{\kt}_{\ddom, \mathrm{d}\ddmes} &= \clbracs{ z \ \vert \ \bracs{0,z,c}\in W^{\wavenumber, \qm}_{\mathrm{grad}}}, \\
		\kgradZero{\ddom}{\ddmes} &= \clbracs{ z \ \vert \ \bracs{0,z,c}\in W^{\wavenumber, 0}_{\mathrm{grad}}}.
	\end{align*}
	Then
	\begin{align*}
		\mathcal{G}^{\kt}_{\ddom, \mathrm{d}\ddmes} &= \kgradZero{\ddom}{\ddmes}.
	\end{align*}
\end{prop}
\begin{proof}
	This proof is essentially identical to proposition \ref{prop:GradZeroInvarientUnderQM}; note that the third component of $\ktgrad\phi$ doesn't depend on $\qm$, and then apply the argument of that proposition to the first and second components to obtain the result.
\end{proof}

Next we move onto characterising $\kgradZero{\ddom}{\ddmes}$, electing to use the same procedure as in section \ref{sec:ScalarExample} and find an edge-wise characterisation, then combine the results to provide a characterisation across a general graph.
To this end we note that the arguments in section \ref{sec:ScalarExample} all apply to the first and second components of $\ktgrad\phi$ (they are in fact identical); this includes the results regarding orientation-preserving orthogonal rotations in the $\bracs{x_1,x_2}$-plane.
As such it will be sufficient for us to determine any changes that are introduced by the presence of the third component of $\ktgrad\phi$.
We begin by assuming that our underlying graph $\graph$ consists of a single edge parallel to the $x_2$-axis.
\begin{prop}[$\wavenumber$-Gradients of Zero on a Segment Parallel to the $x_2$-axis] \label{prop:kGradZeroParallel}
	Let $I$ be a segment in $\ddom$ parallel to the $x_2$-axis and $\lambda_I$ the singular measure supported on $I$.
	Then
	\begin{align*}
		\kgradZero{\ddom}{\lambda_I} = \clbracs{ 
		\begin{pmatrix} f \\ 0 \\ 0	\end{pmatrix} \ \vert \ f\in\ltwo{\ddom}{\lambda_I}
		}
	\end{align*}
\end{prop}
\begin{proof}
	Corollary \ref{cory:CharacterisationGradientsZero} deals with the first two components, so it remains for us to examine the third component.
	Suppose that $f\in\ltwo{\ddom}{\lambda_I}$ and that $\bracs{0,0,f}^\top\in\kgradZero{\ddom}{\lambda_I}$, then there exists a sequence of smooth functions $\phi_n\in\smooth{\ddom}$ such that
	\begin{align*}
		\phi_n \lconv{\ltwo{\ddom}{\lambda_I}} 0, &\quad \begin{pmatrix} \partial_1\phi_n \\ \partial_2\phi_n \\ i\wavenumber\phi_n \end{pmatrix} = \ktgrad\phi_n \lconv{\ltwo{\ddom}{\lambda_I}^3} \begin{pmatrix} 0 \\ 0 \\ f	\end{pmatrix}.
	\end{align*}
	Thus $\phi_n\rightarrow0$ but $i\wavenumber\phi_n\rightarrow f$, hence we must conclude that $f=0$.
\end{proof}

We expect this result as it means that after taking the Fourier transform, our formulation still accounts for (or ``can see") the direction of wave propagation.
Additionally, as the third component of $\ktgrad\phi$ is unaffected by rotations in the $\bracs{x_1,x_2}$-plane, we can utilise proposition \ref{prop:kGradZeroParallel} to state the following result.
\begin{cory}[Characterisation of $\kgradZero{\ddom}{\ddmes}$] \label{cory:CharacterisationkGradientsZero}
	Let $\graph=\bracs{V,E}$ be a finite graph in $\ddom$ and $\ddmes$ the singular measure supported on the edges of $graph$.
	For each $I_{jk}\in E$ let $\lambda_{jk}$ be the singular measure supported on $I_{jk}$, and $e_{jk}$ be the unit vector along $I_{jk}$.
	Then
	\begin{align*}
		\kgradZero{\ddom}{\ddmes} &= \clbracs{ 
		\begin{pmatrix} g_1 \\ g_2 \\ 0 \end{pmatrix}		
		\in\ltwo{\ddom}{\ddmes}^3 \ \vert \ \left.
		\begin{pmatrix} g_1 \\ g_2 \end{pmatrix}
		\right\rvert_{I_{jk}}\cdot e_{jk} = 0 \ \forall I_{jk}\in E } \\
		&= \clbracs{ g\in\ltwo{\ddom}{\ddmes}^3 \ \vert \ g\in\kgradZero{\ddom}{\lambda_{jk}} \ \forall I_{jk}\in E }
	\end{align*}
\end{cory}
\begin{proof}
	Proposition \ref{prop:kGradZeroParallel} provides us with the form for $\kgradZero{\ddom}{\lambda_I}$ when $I$ is parallel to the $x_2$-axis.
	By following the argument of section \ref{sec:ScalarExample}, we can obtain a characterisation for the case when the segment $I$ is orientated at an arbitrary angle to the $x_2$-axis; noting that in each case the third component of an element $g\in\kgradZero{\ddom}{\lambda_I}$ remains identically zero.
	As such we can deduce results analogous to those in section \ref{sec:ScalarExample}; specifically \ref{lem:SmoothGradientsUnderRotation}, \ref{prop:RotationOfEdgeGradients}, \ref{cory:Grad0SingleEdge}, \ref{prop:Grad0IncB}, \ref{lem:SegGradExtend}, and \ref{prop:BIncGrad0}, from which this result follows.
\end{proof}

Establishing this characterisation now allows us to determine the form for tangential $\kt$-gradients; note here that it is now necessary for us to consider an arbitrary $\qm\in[-\pi,\pi)^2$ as the tangential gradient will depend on the quasi-momentum.
Of course it is sufficient for us to determine a edge-wise form for the tangential gradient, and the arguments and results of section \ref{sec:ScalarSystem} apply to provide us with the forms for the first and second component of the tangential $\kt$-gradient.
As such all that remains for us is to explore the third component of the tangential gradient on an edge, and then extend the aforementioned arguments.
As such we now provide some of the details for characterising the tangential $\kt$-gradient on a segment parallel to the $x_2$-axis, then simply state it's general form, referring the reader back to the arguments of section \ref{sec:ScalarSystem} which are easily adapted.
\begin{prop}[Tangential $\kt$-Gradient on a Segment Parallel to the $x_2$-axis] \label{prop:ktTangentialGradientSegment}
	Let $I$ be a segment in $\ddom$ parallel to the $x_2$-axis, and $\lambda_I$ the singular measure supported on $I$.
	Write $\gradSob{\interval{I}}{t}$ for the ``classical" Sobolev space on the interval $\interval{I}$ with respect to the Lebesgue measure; and let $r:\interval{I}\rightarrow I$ be the change of variables map $r(t) = v_I + te_I$, for either endpoint $v_I$ of $I$ and unit vector $e_I$ along $I$ directed away from $v_I$.
	Suppose $u\in\ktgradSob{\ddom}{\lambda_I}$ and let $\widetilde{u} = u\circ r\in\gradSob{\interval{I}}{t}$.
	Then
	\begin{align*}
		\ktgrad_{\lambda_I}u &= \begin{pmatrix} 0 \\ u' + i\qm_2 u \\ i\wavenumber u\end{pmatrix}
	\end{align*}
	where $u' = \widetilde{u}'\circ r^{-1}$.
\end{prop}
\begin{proof}
	Setting $\ktgrad_{\lambda_I}u = \bracs{v_1,v_2,v_3}^{\top}$, the condition of orthogonality to $\kgradZero{\ddom}{\lambda_I}$ requires that
	\begin{align*}
		0 &= \integral{\ddom}{\ktgrad_{\lambda_I}u \cdot \overline{g}}{\lambda_I} \quad \forall g\in\kgradZero{\ddom}{\lambda_I} \\
		&= \integral{I}{v_1 \overline{g}_1}{\lambda_{I}} \quad \forall g_1\in\ltwo{\ddom}{\lambda_I},
	\end{align*}
	so $v_1=0$.
	Turning our attention to the other components, take any sequence $\phi_n\in\smooth{\ddom}$ such that $\phi_n\rightarrow u, \ktgrad\phi_n\rightarrow \bracs{0,v_2,v_3}^\top$.
	These convergences imply that
	\begin{align*}
		\phi_n &\lconv{\ltwo{\ddom}{\lambda_I}} u, \\
		\partial_1\phi_n + i\qm_1 \phi_n \lconv{\ltwo{\ddom}{\lambda_I}} 0, \\
		\partial_2\phi_n + i\qm_2 \phi_n \lconv{\ltwo{\ddom}{\lambda_I}} v_2, \\
		i\wavenumber\phi_n \lconv{\ltwo{\ddom}{\lambda_I}} v_3.
	\end{align*}
	But $\phi_n \lconv{\ltwo{\ddom}{\lambda_I}} u$ implies that $v_3 = i\wavenumber u$.
	This leaves us determining the form for $v_2$, where we direct the reader to the process detailed in lemma \ref{lem:TangentialQMGradientSegmentParallel} which demonstrates how to show that $v_2 = u' + i\qm_2 u$, which completes the proof.
\end{proof}

The form for the tangential $\kt$-gradient when the segment $I$ is at an arbitrary angle in the $\bracs{x_1,x_2}$-plane follows by applying a rotation to the previous result; and this in turn gives us an analogue of corollary \ref{cory:TangentialQMGradientGraphs}.
\begin{cory}[$\kt$-Tangential Gradient on Graphs] \label{cory:ktTangentialGradientForm}
	Let $\graph=\bracs{V,E}$ be a graph embedded into $\ddom$ and let $\ddmes$ be the singular measure supported on $\graph$.
	Denote by $x=\bracs{x_1,x_2}$ the axes co-ordinate system.
	For each $I_{jk}\in E$, denote the restriction of $u$ to $I_{jk}$ by $u_{jk} = u\vert_{I_{jk}}$.
	Also equip each $I_{jk}$ with a local orthogonal co-ordinate system $y=\bracs{y_1,y_2}$ with $y_2$ parallel to $I_{jk}$, such that $x=R_{jk}y$ for some $R_{jk}\in\mathrm{SO}(2)$.
	If $u\in\ktgradSob{\ddom}{\ddmes}$ then
	\begin{align*}
		\left.\ktgrad_{\ddmes}u\right\vert_{I_{jk}} = \begin{pmatrix} R_{jk}^\top & 0 \\ 0 & 1 \end{pmatrix} \begin{pmatrix} 0 \\ u' + i\bracs{R_{jk}\qm}_2 u \\ iku \end{pmatrix},
	\end{align*}
	for every $I_{jk}\in E$.
\tstk{this was $y_1$ parallel to $I_{jk}$, the 1st component of $R_{jk}\qm$, and was placed in the first component of the vector, but the two are equivalent... I think :L}
\end{cory}
\begin{proof}
	It is sufficient to find an edge-wise characterisation for the tangential $\kt$-gradient, and we can apply a rotation to the result of proposition \ref{prop:ktTangentialGradientSegment} to obtain the form for the tangential $\kt$-gradient on any segment in $\ddom$.
\end{proof}

\subsection{The Divergence-Free Condition} \label{sec:ktDivFree}
Having established characterisations for both $\kgradZero{\ddom}{\ddmes}$ (corollary \ref{cory:CharacterisationkGradientsZero}) and the tangential gradients (corollary \ref{cory:ktTangentialGradientForm}), we can now examine what it means for a function $u\in\ktcurlSob{\ddom}{\ddmes}$ to be divergence-free.
As usual it is sufficient for us to consider a single edge $I$ and the edge-wise nature of $\ddmes$ to extend the results to the whole of $\graph$.
\begin{lemma}[Divergence-Free Functions on a Segment Parallel to the $x_2$-axis] \label{lem:DivFreeParallelSegment}
	Let $I$ be a segment in $\ddom$ parallel to the $x_2$-axis, and $\lambda_I$ be the singular measure supported on $I$.
	Denote by $\gradSob{\interval{I}}{\lambda_I}$ the ``classical" Sobolev space on $\interval{I}$ with respect to the Lebesgue measure; and let $r:\interval{I}\rightarrow I$ be the change of variables $r(t)= v_I + t e_I$, for some endpoint $v_I$ of $I$ and unit vector $e_I$ parallel to $I$ and directed away from $v_I$.
	Suppose $u=\bracs{u_1, u_2, u_3}^\top\in\curlSob{\ddom}{\lambda_I}$ is divergence-free.
	Then $\widetilde{u}_2 = u \circ r$ and $\widetilde{u}_3 = u_3 \circ r$ satisfy
	\begin{align*}
		-\bracs{\diff{}{t} + i\qm_2}\widetilde{u}_2 &= i\wavenumber\widetilde{u}_3,
	\end{align*}
	where $\diff{\widetilde{u}_2}{t} = \widetilde{u}'_2$ is understood in the $\gradSob{\interval{I}}{t}$ sense.
\end{lemma}
\begin{proof}
	We simply check the requirement that $u$ be orthogonal to all gradients, first against gradients of zero and then against tangential $\kt$-gradients.
	We know that $g\in\kgradZero{\ddom}{\lambda_I}$ is such that $g=\bracs{g_1,0,0}^\top$ by proposition \ref{prop:kGradZeroParallel}, so
	\begin{align*}
		0 &= \integral{\ddom}{ u\cdot\overline{g} }{\lambda_I} \quad\forall g\in\kgradZero{\ddom}{\lambda_I}, \\
		\implies 0 &= \integral{I}{ u_1 \overline{g_1} }{\lambda_I} \quad \forall g_1\in\ltwo{\ddom}{\lambda_I}.
	\end{align*}
	Thus $u_1 = 0$.
	Now suppose that $\ktgrad_{\lambda_I} v$ is a tangential $\kt$-gradient of $v\in\ktgradSob{\ddom}{\lambda_I}$.
	Then
	\begin{align*}
		0 &= \integral{\ddom}{u_2\overline{\bracs{v'+i\qm_2 v}} - i\wavenumber u_3\overline{v}}{\lambda_I} \\
		&= \int_0^{\abs{I}} \widetilde{u}_2\overline{\bracs{\widetilde{v}' + i\qm_2 \widetilde{v}}} - i\wavenumber\widetilde{u}_3\overline{\widetilde{v}} \ \md t \\
		&= \int_0^{\abs{I}} \overline{\widetilde{v}}\bracs{-\widetilde{u}'_2 - i\qm_2 \widetilde{u}_2 - i\wavenumber\widetilde{u}_3} \ \md t.
	\end{align*}
	This holds for each $v\in\ltwo{\ddom}{\lambda_I}$ and hence for each $\widetilde{v}\in\ltwo{\interval{I}}{t}$, and so we conclude that
	\begin{align*}
		-\bracs{\diff{}{t} + i\qm_2}\widetilde{u}_2 &= i\wavenumber\widetilde{u}_3,
	\end{align*}
	which was the desired result.
\end{proof}

\begin{prop}[Divergence-Free Functions on a Segment] \label{prop:DivFreeGeneralSegment}
	Let $I$ be a segment in $\ddom$ with local co-ordinate system $y=\bracs{y_1,y_2}$ with $y_2$ parallel to $I$, and $\lambda_I$ the singular measure supported on $I$.
	Let $x=\bracs{x_1,x_2}$ be the axes co-ordinate system and $R\in\mathrm{SO}(2)$ such that $x=Ry$.
	Furthermore denote by $\gradSob{\interval{I}}{\lambda_I}$ the ``classical" Sobolev space on $\interval{I}$ with respect to the Lebesgue measure; and let $r:\interval{I}\rightarrow I$ be the change of variables $r(t)= v_I + t e_I$, for some endpoint $v_I$ of $I$ and unit vector $e_I$ parallel to $I$ and directed away from $v_I$.
	Suppose $u=\bracs{u_1, u_2, u_3}^\top\in\curlSob{\ddom}{\lambda_I}$ is divergence-free.
	Then $\widetilde{u}_2 = u \circ r$ and $\widetilde{u}_3 = u_3 \circ r$ satisfy
	\begin{align*}
		-\bracs{\diff{}{t} + i\bracs{R\qm}_2}\widetilde{u}_2 &= i\wavenumber\widetilde{u}_3,
	\end{align*}
	where $\diff{\widetilde{u}_2}{t} = \widetilde{u}'_2$ is understood in the $\gradSob{\interval{I}}{t}$ sense.
\end{prop}
\begin{proof}
	This is just a rotation of the previous result, or alternatively one can work directly from corollary \ref{cory:ktTangentialGradientForm}.
\end{proof}

Thus we arrive at the following classification for divergence-free functions on graphs.
\begin{cory}[Divergence-Free Functions on a Graph] \label{cory:DivFreeWholeGraph}
	Let $\graph=\bracs{V,E}$ be a graph embedded into $\ddom$ and $\ddmes$ the singular measure supported on the edges of $\graph$.
	For each $I_{jk}\in E$ let $\lambda_{jk}$ be the singular measure supported on $I_{jk}$, and denote $u^{(jk)} = u\vert_{I_{jk}}$ as the restriction of $u$ to $I_{jk}$.
	Let $r_{jk}:\interval{I_{jk}}\rightarrow I_{jk}$ be the change of variables map $r(t)=v_{j} + te_{jk}$ where $e_{jk}$ is the unit vector parallel to $I_{jk}$ directed from $v_j$ to $v_k$.
	Suppose $u\in\ktcurlSob{\ddom}{\ddmes}$ is divergence-free.
	Then for each $I_{jk}\in E$; the functions 
	\begin{align*}
		\widetilde{u}^{(jk)}_2 = u^{(jk)}_2 \circ r_{jk},
		&\quad \widetilde{u}^{(jk)}_3 = u^{(jk)}_3 \circ r_{jk},
	\end{align*}
	satisfy \tstk{shouldn't there also be a resulting vertex condition too?? Probably need to do some graph-wide analysis of this!}
	\begin{align*}
		-\bracs{\diff{}{t} + i\bracs{R_{jk}\qm}_2}\widetilde{u}^{(jk)}_2 &= i\wavenumber\widetilde{u}^{(jk)}_3,
	\end{align*}
	where the derivative is understood in the $\gradSob{\interval{I_{jk}}}{t}$ sense.
\end{cory}
\begin{proof}
	\tstk{this could well be more complicated than this!!!}
\end{proof}

\subsection{$\bracs{\wavenumber,\qm}$-curls} \label{sec:ktCurls}
Our primary focus here is to characterise tangential curls; and our analysis follows in much of the same vein as in section \ref{sec:ScalarExample}.
First we seek an edge-wise understanding for $\bracs{\wavenumber,\qm}$-curls of zero and tangential curls, then we derive an extension result (c.f. \tstk{extension lemma result here}) for curls so that our edge-wise characterisation also provides us with a graph-wide form for the curl.
We will need the following result on rotations during this section:
\tstk{rotating curls goes here}

\section{Reduction to Quantum Graphs} \label{sec:CurlReductionToQG}

\section{Chapter Summary} \label{sec:CurlSummary}